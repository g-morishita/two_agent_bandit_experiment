var jsPsychImageKeyboardResponse=function(t){"use strict";const e={name:"image-keyboard-response",parameters:{stimulus:{type:t.ParameterType.IMAGE,pretty_name:"Stimulus",default:void 0},stimulus_height:{type:t.ParameterType.INT,pretty_name:"Image height",default:null},stimulus_width:{type:t.ParameterType.INT,pretty_name:"Image width",default:null},maintain_aspect_ratio:{type:t.ParameterType.BOOL,pretty_name:"Maintain aspect ratio",default:!0},choices:{type:t.ParameterType.KEYS,pretty_name:"Choices",default:"ALL_KEYS"},prompt:{type:t.ParameterType.HTML_STRING,pretty_name:"Prompt",default:null},stimulus_duration:{type:t.ParameterType.INT,pretty_name:"Stimulus duration",default:null},trial_duration:{type:t.ParameterType.INT,pretty_name:"Trial duration",default:null},response_ends_trial:{type:t.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},render_on_canvas:{type:t.ParameterType.BOOL,pretty_name:"Render on canvas",default:!0}}};class s{constructor(t){this.jsPsych=t}trial(t,e){var s,i;if(e.render_on_canvas){var a=!1;if(t.hasChildNodes())for(;t.firstChild;)t.removeChild(t.firstChild);var l=document.createElement("canvas");l.id="jspsych-image-keyboard-response-stimulus",l.style.margin="0",l.style.padding="0";var r=l.getContext("2d");(u=new Image).onload=()=>{a||(n(),r.drawImage(u,0,0,i,s))},u.src=e.stimulus;const n=()=>{null!==e.stimulus_height?(s=e.stimulus_height,null==e.stimulus_width&&e.maintain_aspect_ratio&&(i=u.naturalWidth*(e.stimulus_height/u.naturalHeight))):s=u.naturalHeight,null!==e.stimulus_width?(i=e.stimulus_width,null==e.stimulus_height&&e.maintain_aspect_ratio&&(s=u.naturalHeight*(e.stimulus_width/u.naturalWidth))):null!==e.stimulus_height&&e.maintain_aspect_ratio||(i=u.naturalWidth),l.height=s,l.width=i};n(),t.insertBefore(l,null),u.complete&&Number.isFinite(i)&&Number.isFinite(s)&&(r.drawImage(u,0,0,i,s),a=!0),null!==e.prompt&&t.insertAdjacentHTML("beforeend",e.prompt)}else{var n='<img src="'+e.stimulus+'" id="jspsych-image-keyboard-response-stimulus">';null!==e.prompt&&(n+=e.prompt),t.innerHTML=n;var u=t.querySelector("#jspsych-image-keyboard-response-stimulus");null!==e.stimulus_height?(s=e.stimulus_height,null==e.stimulus_width&&e.maintain_aspect_ratio&&(i=u.naturalWidth*(e.stimulus_height/u.naturalHeight))):s=u.naturalHeight,null!==e.stimulus_width?(i=e.stimulus_width,null==e.stimulus_height&&e.maintain_aspect_ratio&&(s=u.naturalHeight*(e.stimulus_width/u.naturalWidth))):null!==e.stimulus_height&&e.maintain_aspect_ratio||(i=u.naturalWidth),u.style.height=s.toString()+"px",u.style.width=i.toString()+"px"}var m={rt:null,key:null};const o=()=>{this.jsPsych.pluginAPI.clearAllTimeouts(),void 0!==h&&this.jsPsych.pluginAPI.cancelKeyboardResponse(h);var s={rt:m.rt,stimulus:e.stimulus,response:m.key};t.innerHTML="",this.jsPsych.finishTrial(s)};if("NO_KEYS"!=e.choices)var h=this.jsPsych.pluginAPI.getKeyboardResponse({callback_function:s=>{t.querySelector("#jspsych-image-keyboard-response-stimulus").className+=" responded",null==m.key&&(m=s),e.response_ends_trial&&o()},valid_responses:e.choices,rt_method:"performance",persist:!1,allow_held_key:!1});null!==e.stimulus_duration&&this.jsPsych.pluginAPI.setTimeout((()=>{t.querySelector("#jspsych-image-keyboard-response-stimulus").style.visibility="hidden"}),e.stimulus_duration),null!==e.trial_duration?this.jsPsych.pluginAPI.setTimeout((()=>{o()}),e.trial_duration):!1===e.response_ends_trial&&console.warn("The experiment may be deadlocked. Try setting a trial duration or set response_ends_trial to true.")}simulate(t,e,s,i){"data-only"==e&&(i(),this.simulate_data_only(t,s)),"visual"==e&&this.simulate_visual(t,s,i)}simulate_data_only(t,e){const s=this.create_simulation_data(t,e);this.jsPsych.finishTrial(s)}simulate_visual(t,e,s){const i=this.create_simulation_data(t,e),a=this.jsPsych.getDisplayElement();this.trial(a,t),s(),null!==i.rt&&this.jsPsych.pluginAPI.pressKey(i.response,i.rt)}create_simulation_data(t,e){const s={stimulus:t.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),response:this.jsPsych.pluginAPI.getValidKey(t.choices)},i=this.jsPsych.pluginAPI.mergeSimulationData(s,e);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(t,i),i}}return s.info=e,s}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
